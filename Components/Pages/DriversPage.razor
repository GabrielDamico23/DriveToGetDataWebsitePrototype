@page "/f1drivers"
@using DriveToGetDataWebsitePrototype.Data
@using DriveToGetDataWebsitePrototype.Models
@using Microsoft.EntityFrameworkCore
@inject ApplicationDbContext DbContext
@rendermode InteractiveServer

<div class="PageHeader">
    <h2>Formula 1 Drivers</h2>
</div>
<div class="UserSelection">
    <p>This page will be displaying Formula 1 drivers details for drivers which raced between 2022 and 2024.</p>
    <br/>
    <p>Choose a driver to learn more about them:</p>

    <select id="DriverSelect" @onchange="OnDriverSelected">
        <option value="">Select a driver</option>
        @foreach (var driver in drivers)
        {
            <option value="@driver.F1DriverId">@($"{driver.GivenName} {driver.FamilyName}")</option> // Display driver name in a dropdown list
        }
    </select>
</div>

<div class="UserSelectionInformation">
    @if (selectedDriver != null) // Display driver details if a driver is selected
    {
        <div>
            @*//driver details*@
            <h3>You have selected: @($"{selectedDriver.GivenName} {selectedDriver.FamilyName}")</h3>
            <p>@($"{selectedDriver.GivenName} {selectedDriver.FamilyName}") is a @selectedDriver.Nationality driver and was born in @selectedDriver.DateOfBirth. He races with the number @selectedDriver.PermanentNumber.</p>
            <p>If you would like more information on @($"{selectedDriver.GivenName} {selectedDriver.FamilyName}"), kindly click <a href="@selectedDriver.Url" target="_blank">here</a></p>
        </div> 
    }
    else  // Display message if no driver is selected)
    {
        <p>Select a driver to see details.</p>
    }
</div>

<div class="PageFooter">
    <ul>
        <li><a href="/home">Home</a></li>
        <li><a href="/racedata">Race Data</a></li>
        <li><a href="/f1constructors">Formula 1</a></li>
        <li><a href="/f1drivers">Drivers</a></li>
        <li><a href="/f1circuits">Circuits</a></li>
        <li><a href="/contactus">Contact Us</a></li>
    </ul>
    <p>This is a website prototype to be used in a Computing project by STU 84304 at Arden University and will be submitted in October 2024. This website is not to be published. </p>
</div>



@code {
    private List<F1Driver> drivers = new List<F1Driver>(); // New list of drivers to store driver details
    private F1Driver selectedDriver; // Selected driver

    protected override async Task OnInitializedAsync()
    {
        await LoadDrivers(); // Load drivers from the database
    }

    private async Task LoadDrivers()
    {
        drivers = await DbContext.Drivers.ToListAsync(); // Get all drivers from the database Driver table and store in the drivers list
    }

    private async Task OnDriverSelected(ChangeEventArgs e)
    {
        var driverId = e.Value?.ToString(); // Get the selected driver ID from the dropdown list

        if (!string.IsNullOrEmpty(driverId)) // If a driver is selected
        {
            selectedDriver = await DbContext.Drivers
                .FirstOrDefaultAsync(d => d.F1DriverId == driverId); // Get driver details

            StateHasChanged(); // Refresh component
        }
        else
        {
            selectedDriver = null; // Reset if no driver is selected
            StateHasChanged();
        }
    }
}
